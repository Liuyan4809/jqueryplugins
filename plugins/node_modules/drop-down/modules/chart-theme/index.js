// 默认配置
let g_default_options = null;
// 原始元素
let g_$origin = null;
// 主渲染元素DOM
let g_$target = null;
// 渲染的下拉内容主体
let g_$selectAnim = null;
import g_theme from './theme.js'
/**
 * 渲染下拉内容
 */
function renderDOM() {
  let html = '';
  for (let name in g_theme) {
    html += `<dd title="${g_theme[name].title}" data-name="${name}">`;
    for (let i = 0, color;
      (color = g_theme[name].color[i++]) && i < 7;) {
      html += `<span class="color-block" style="background-color: ${color};"></span>`;
    }
    html += '</dd>';
  }
  g_$selectAnim = g_$target.find('.drop-down__anim').html(html);
}

/**
 * 绑定事件
 */
function bindEvent() {
  // 绑定渲染对象事件
  bindTarget();
}

function bindTarget() {
  g_$target.on('click', function(e) {
    let $t = $(e.target);
    let $btn = $t.closest('.drop-down__button');
    let $dd = $t.closest('dd');
    // 点击按钮
    if ($btn.length) {
      g_$target.toggleClass('drop-down__selected');
    }
    // 点击dd
    if ($dd.length) {
      $dd.toggleClass('drop-down__this').siblings().removeClass('drop-down__this');
      // 隐藏下拉列表
      g_$target.removeClass('drop-down__selected');
      // 如果选中值得话,触发change事件
      g_$origin.trigger('change',$dd.data('name'));
    }
  });
}

export default {
  render($target,option,$origin) {
    // 赋值属性
    g_$origin = $origin;
    g_$target = $target;
    g_default_options = option;
    // 渲染下拉内容
    renderDOM(g_$target, g_default_options);
    // 绑定事件
    bindEvent();
  }
}
